# Build Scripts

This directory contains all of the different scripts that run throughout the build and development cycles.  Any messages generated by these scripts will appear in your terminal window.  The `build/watch.js` script runs a single watcher and runs a build script (resize images, inject date into frontmatter on save, etc.) depending on which file was changed. To kick off the watchers and a development server run `npm start`.

## watch.js

A single script that watches source files and processes them according to their type and source file location.  For example if a content file is edited the frontmatter is updated to the current date and the hugo site is rebuilt.  If a hero image is saved it is processed into small, medium and full-size images in the `dist` directory.

## create-dist.js

This scripts checks that all of the necessary directories in the final `dist` folder are present. If any of the required directories are absent they are automatically created using [mkdirp](https://www.npmjs.com/package/mkdirp) to avoid errors related to writing files to non-existent directories.

## hero.js

This script takes all of the images from `src/images/hero`, resizes them to the same width using [sharp](https://www.npmjs.com/package/sharp) and optimizes them with [imagemin](https://www.npmjs.com/package/imagemin).  All files are written to `site/static/images/hero/` keeping the same filename as the original source photo.  This script is called by both `build/build.js` and `build/watch.js`.

## hugo.js

This script clears everything out of the `dist` folder before it creates a subprocess that runs the [`Hugo` command](https://gohugo.io/commands/hugo/).  This script takes a single parameter, `baseURL`, which allows us to create different builds for `development`, `staging`, and `production` environments.  This script is called by both `build/build.js` and `build/watch.js`.

## images.js

This script looks for folders in the `src/images/pages` directory.  The scripts infers the intended output width of each image based on the name of the containing directory.  For example, any images in `src/images/pages/400` will be resized to 400px wide using [sharp](https://www.npmjs.com/package/sharp) and copied to `site/static/images/pages/` with the original file name from the source directory.  If you need an image to be a different size you can create a new directory in `src/images/pages` with a number representing the desired output width.  This script is called by both `build/build.js` and `build/watch.js`.

## frontmatter.js

This script automatically injects the current date into the page's [frontmatter](https://gohugo.io/content/front-matter/).  This date is then used by website templates to display a **Last Updated** date in the site footer.  This script also implements tests for content metadata.  For example if no tags are provided a warning is logged to the console.  Tests include:

  - Tags are required, the script automatically title-cases tags
  - Hero image including `name`, `alt`, and `caption` are all required

**We're currently working on a solution for injecting last updated dates into the homepage and other complicated HTML based pages like Mega Map.**

This script is called by `build/watch.js` when a content file is updated and saved.

## minify-json.js

This script [validates](https://github.com/zaach/jsonlint) and [minifies](https://www.npmjs.com/package/jsonminify) each of the `*.json` files and copies the output to `dist/data`.  The output uses the same filename as the input except that the extension is changed from `.json` to `.js`.  This change is necessary due to issues with the web server that prevent the use of downloading `.json` files with AJAX.  This script is called by both `build/build.js` and `build/watch.js`.

## csv-to-json.js

This script converts CSV data from `src/data` to JSON with [csvtojson](https://www.npmjs.com/package/csvtojson) and minifies the output with [jsonminify](https://www.npmjs.com/package/jsonminify).  Data is output to `dist/data` where it can be accessed through AJAX requests by webpage scripts to display/manipulate the data. This script is called by both `build/build.js` and `build/watch.js`.
