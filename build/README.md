# Build Scripts

This directory contains all of the different scripts that run throughout the build and development cycles.  Any messages generated by these scripts will appear in your terminal window.  Many of these scripts include a built in [file watcher](https://www.npmjs.com/package/chokidar) to re-run the script when a change is made.  This is a much better approach to resizing and optimizing every photo each time a new image is added. These watchers can be enabled by setting the `WATCH` environment variable:

```
WATCH=true npm start
```

## create-dist.js

This scripts checks that all of the necessary directories in the final `dist` folder are present. If any of the required directories are absent they are automatically created using [mkdirp](https://www.npmjs.com/package/mkdirp) to avoid errors related to writing files to non-existent directories.

## hero.js

This script takes all of the images from `src/images/hero`, resizes them to the same width using [sharp](https://www.npmjs.com/package/sharp) and optimizes them with [imagemin](https://www.npmjs.com/package/imagemin).  All files are written to `site/static/images/hero/` keeping the same filename as the original source photo.  This script also includes a watcher; when an image is added, changed, or removed from `src/images/hero/`, it will automatically be resized, and optimized, or removed from the output directory.  To enable the watcher set the `WATCH` environment variable:

```
WATCH=true npm run hero
```

## hugo.js

This script clears everything out of the `dist` folder before it creates a subprocess that runs the [`Hugo` command](https://gohugo.io/commands/hugo/).  This script takes a single parameter, `baseURL`, which allows us to create different builds for `development`, `staging`, and `production` environments.  This script includes a built-in watcher, which will re-build the site each time a file is changed in the `site/` directory. To enable the watcher set the `WATCH` environment variable:

```
WATCH=true npm run hugo
```

## images.js

This script looks for folders in the `src/images/pages` directory.  The scripts infers the intended output width of each image based on the name of the containing directory.  For example, any images in `src/images/pages/400` will be resized to 400px wide using [sharp](https://www.npmjs.com/package/sharp) and copied to `site/static/images/pages/` with the original file name from the source directory.  If you need an image to be a different size you can create a new directory in `src/images/pages` with a number representing the desired output width.  This script includes a file watcher; any image added, changed, or removed the images will be processed (or removed) automatically.  To enable the watcher set the `WATCH` environment variable:

```
WATCH=true npm run images
```

## frontmatter.js

This script watches Markdown files in the `site/content` directory (and subdirectories) for changes and automatically injects the current date into the page's [front matter](https://gohugo.io/content/front-matter/).  This date is then used by website templates to display a **Last Updated** date in the site footer.  This script also implements tests for content metadata.  For example if no tags are provided a warning is logged to the console.  Tests include:

  - Tags are required, the script automatically title-cases tags
  - Hero image including `name`, `alt`, and `caption` are all required

**We're currently working on a solution for injecting last updated dates into the homepage and other complicated HTML based pages like Mega Map.**

## minify-json.js

This script watches the `src/data` directory for changes and automatically [validates](https://github.com/zaach/jsonlint) and [minifies](https://www.npmjs.com/package/jsonminify) each of the `*.json` files and copies the output to `site/static/data`.  The output uses the same filename as the input except that the extension is changed from `.json` to `.js`.  This change is necessary due to issues with the web server that prevent the use of downloading `.json` files with AJAX.  This script includes a watcher, which will automatically re-minify JSON when a file is added, or changed. To enable the watcher set the `WATCH` environment variable:

```
WATCH=true npm run images
```
